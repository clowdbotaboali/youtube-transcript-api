import Groq from 'groq-sdk';
import dotenv from 'dotenv';

dotenv.config();

const prompts = {
  summary: (transcript) => `ูู ุจุชูุฎูุต ุงููุต ุงูุชุงูู ุจุงููุบุฉ ุงูุนุฑุจูุฉ ุจุดูู ุดุงูู ููููุฏ:
- ุงุฐูุฑ ุงูููุถูุน ุงูุฑุฆูุณู
- ุงูููุงุท ุงููููุฉ
- ุงูุงุณุชูุชุงุฌุงุช ุงูุฑุฆูุณูุฉ

ุงููุต: ${transcript}`,

  steps: (transcript) => `ุฃูุช ูุณุงุนุฏ ุฎุจูุฑ ูู ุชุญููู ุงูููุฏูููุงุช ุงูุชุนููููุฉ ูุงุณุชุฎุฑุงุฌ ุงูุฎุทูุงุช ุจุฏูุฉ ุดุฏูุฏุฉ.

ูููุชู: ุงุณุชุฎุฑุฌ **ูู ุฎุทูุฉ** ูู ุงูููุฏูู ุจุงูุชุฑุชูุจุ ุจุชูุงุตูู ุฏูููุฉ ุฌุฏุงูุ ูุฃูู ุจุชุดุฑุญ ูุดุฎุต ููููุฐ ุงูุฎุทูุงุช ูุณูุงุฑ ูุณูุงุฑ.

**ูุชุทูุจุงุช ูููุฉ:**
1. ูุง ุชูุฎุต - ุงูุชุจ ูู ุฎุทูุฉ ุจุงูุชูุตูู ุงูููู
2. ุงุฐูุฑ ุฃุณูุงุก ุงูุฃุฏูุงุช/ุงูุจุฑุงูุฌ/ุงูููุงูุน ุจุงูุถุจุท ููุง ุฐููุฑุช
3. ุงุฐูุฑ ุงูุฃุฑูุงู ูุงูุฅุนุฏุงุฏุงุช ุจุงูุถุจุท (ูุซูุงู: 13 frames, -20 dB, 0.5 seconds)
4. ููุง ุงููุญุงุถุฑ ูููู "ุงุณุชุฎุฏู ูุฐุง ุงูู prompt" - ุงูุชุจ ุงูู prompt ูุงููุงู
5. ูู ุฐูุฑ ูููุงุช ุฎุงุฑุฌูุฉ ุฃู ูุณุชูุฏุงุช - ุงูุชุจูุง ุจูุถูุญ
6. ูู ุฐูุฑ shortcuts ุฃู ุฃุฒุฑุงุฑ - ุงูุชุจูู
7. ูู ุฐูุฑ ุฃูุซูุฉ - ุงูุชุจ ุงูุฃูุซูุฉ

**ุงูุชูุณูู ุงููุทููุจ (Todo List):**

## ๐ ุฎุทุฉ ุงูุนูู ุงููุงููุฉ

### ุงููุฑุญูุฉ 1: [ุงุณู ุงููุฑุญูุฉ]

#### โ ุงููููุฉ 1.1: [ุนููุงู ุงููููุฉ]
**ุงูุดุฑุญ ุงูุชูุตููู:**
- [ูู ุงูุชูุงุตูู ุจุงูุชุฑุชูุจ]
- [ุงูุฅุนุฏุงุฏุงุช ุงููุญุฏุฏุฉ]
- [ุงูุฃุฏูุงุช ุงููุณุชุฎุฏูุฉ]

**ุงูุฃุฏูุงุช ุงููุทููุจุฉ:**
- [ุงุณู ุงูุฃุฏุงุฉ/ุงูุจุฑูุงูุฌ/ุงููููุน]

**ููุงุญุธุงุช ูููุฉ:**
- [ุฃู ุชุญุฐูุฑุงุช ุฃู ูุตุงุฆุญ]

---

#### โ ุงููููุฉ 1.2: [ุนููุงู ุงููููุฉ]
...

**ูุซุงู ุนูู ุงูุชูุตูู ุงููุทููุจ:**
ุจุฏูุงู ูู: "ุฃุถู transitions ุจูู ุงูููุงุทุน"
ุงูุชุจ: "ุฃุถู Push Right transition ุจูู ุงูููุงุทุน ุงููุจูุฑุฉุ ูุงุถุจุท ุงููุฏุฉ ุนูู 13 frames ูู Filmora ุฃู 0.5 seconds ูู CapCut. ุฃุถู ูุนูุง Click sound effect ูููู ุตูุชูุง ูู -8 dB"

ุงููุต: ${transcript}`,

  resources: (transcript) => `ุงุณุชุฎุฑุฌ **ูู** ุงูุฃุฏูุงุช ูุงูุจุฑุงูุฌ ูุงูููุงูุน ูุงููููุงุช ุงููุฐููุฑุฉ ูู ุงููุต ุงูุชุงูู.

**ูุชุทูุจุงุช:**
1. ุงูุชุจ ุงุณู ูู ุฃุฏุงุฉ/ุจุฑูุงูุฌ/ูููุน **ุจุงูุถุจุท** ููุง ุฐููุฑ
2. ุงุดุฑุญ ุงุณุชุฎุฏุงููุง ุจุงูุชูุตูู
3. ูู ููู ุฅุนุฏุงุฏุงุช ูุญุฏุฏุฉ - ุงูุชุจูุง
4. ูู ููู ูุณุฎุฉ ูุฌุงููุฉ/ูุฏููุนุฉ - ุงุฐูุฑูุง
5. ูู ููู ุญุฏูุฏ ุงุณุชุฎุฏุงู - ุงุฐูุฑูุง

**ุงูุชูุณูู:**

## ๐๏ธ ุงูุฃุฏูุงุช ูุงูุจุฑุงูุฌ ุงููุณุชุฎุฏูุฉ

### 1. [ุงุณู ุงูุฃุฏุงุฉ]
- **ุงูููุน:** [ูููุน ููุจ / ุจุฑูุงูุฌ / ุงูุชุฏุงุฏ]
- **ุงูุงุณุชุฎุฏุงู:** [ูุงุฐุง ุชูุนู ุจุงูุถุจุท]
- **ุงูุณุนุฑ:** [ูุฌุงูู / ูุฏููุน / freemium]
- **ุงูุญุฏูุฏ:** [ุฅู ูุฌุฏุช]
- **ุงูุฅุนุฏุงุฏุงุช ุงููุณุชุฎุฏูุฉ:** [ุฃู ุฅุนุฏุงุฏุงุช ูุญุฏุฏุฉ ุฐููุฑุช]
- **ุงูุฑุงุจุท:** [ุฅู ุฐููุฑ]

ุงููุต: ${transcript}`,

  all: (transcript) => `ุฃูุช ูุณุงุนุฏ ุฎุจูุฑ ูู ุชุญููู ุงูููุฏูููุงุช ุงูุชุนููููุฉ. ูููุชู ุชุญููู ุงูููุฏูู ุฅูู ุฏููู ุนูู ูุงูู ูุงุจู ููุชูููุฐ.

**ุงูููุงุนุฏ ุงูุฐูุจูุฉ:**
1. **ูุง ุชูุฎุต** - ุงูุชุจ ูู ุงูุชูุงุตูู
2. **ุงุฐูุฑ ุงูุฃุณูุงุก ุจุงูุถุจุท** - ุฃุฏูุงุชุ ุจุฑุงูุฌุ ููุงูุนุ ูููุงุช
3. **ุงุฐูุฑ ุงูุฃุฑูุงู ูุงูุฅุนุฏุงุฏุงุช ุจุงูุถุจุท** - ูุง ุชูุฑูุจ
4. **ุงูุชุจ ุงูุฃูุซูุฉ ูุงูู prompts ูุงููุฉ** ุฅู ุฐููุฑุช
5. **ูุณูู ูู Todo List** - ูู ุฎุทูุฉ ูููุฉ ุชูุดูู ุนูููุง
6. **ูู ุฐูุฑ ูููุงุช ุฎุงุฑุฌูุฉ** - ุงูุชุจ "ุงูุฎุทูุฉ ุฏู ูู ููู [ุงุณู ุงูููู]"

---

## ๐ ูุธุฑุฉ ุนุงูุฉ
[ููุฎุต ุณุฑูุน ุนู ููุถูุน ุงูููุฏูู ูู 3-4 ุฌูู]

---

## ๐ฏ ุงููุฏู ุงูููุงุฆู
[ูุงุฐุง ุณุชุญูู ุจุนุฏ ุชูููุฐ ูู ุงูุฎุทูุงุช]

---

## ๐ ุฎุทุฉ ุงูุนูู ุงููุงููุฉ (Todo List)

### ๐น ุงููุฑุญูุฉ 1: [ุงุณู ุงููุฑุญูุฉ]

#### โ ุงููููุฉ 1.1: [ุนููุงู ูุงุถุญ]
**ุงูุดุฑุญ ุงูุชูุตููู:**
- [ุฎุทูุฉ ุจุฎุทูุฉ ุจุงูุชุฑุชูุจ]
- [ูู ุงูุชูุงุตูู ุงูุตุบูุฑุฉ]
- [ุงูุฅุนุฏุงุฏุงุช ุงููุญุฏุฏุฉ ุจุงูุฃุฑูุงู]

**ุงูุฃุฏูุงุช ุงููุทููุจุฉ:**
- [ุงุณู ุงูุฃุฏุงุฉ ุจุงูุถุจุท]

**ุงูุฅุนุฏุงุฏุงุช ุงูุฏูููุฉ:**
- [ุฃู ุฃุฑูุงู ุฃู ุฎูุงุฑุงุช ูุญุฏุฏุฉ]

**ุฃูุซูุฉ ูู ุงูููุฏูู:**
- [ุฃู ุฃูุซูุฉ ุฐูุฑูุง ุงููุญุงุถุฑ]

**ููุงุญุธุงุช:**
- [ุชุญุฐูุฑุงุช ุฃู ูุตุงุฆุญ]

---

#### โ ุงููููุฉ 1.2: [ุนููุงู ุงููููุฉ]
...

### ๐น ุงููุฑุญูุฉ 2: [ุงุณู ุงููุฑุญูุฉ]
...

---

## ๐๏ธ ูุงุฆูุฉ ุงูุฃุฏูุงุช ุงููุงููุฉ

### 1. [ุงุณู ุงูุฃุฏุงุฉ]
- **ุงูุงุณุชุฎุฏุงู:** [ุจุงูุชูุตูู]
- **ุงูุณุนุฑ:** [ูุฌุงูู/ูุฏููุน]
- **ุงูุญุฏูุฏ:** [ุฅู ูุฌุฏุช]
- **ุงูุฅุนุฏุงุฏุงุช:** [ุฃู ุฅุนุฏุงุฏุงุช ุฐููุฑุช]

---

## ๐ ุงูุฑูุงุจุท ูุงููุตุงุฏุฑ
- [ูู ูููุน ุฃู ูุตุฏุฑ ุฐููุฑ]

---

## โ๏ธ ูุตุงุฆุญ ูุชุญุฐูุฑุงุช ูููุฉ
- [ูู ุงููุตุงุฆุญ ูุงูุชุญุฐูุฑุงุช ุงูุชู ุฐูุฑูุง ุงููุญุงุถุฑ]

---

## โ ูุนุงููุฑ ุงููุฌุงุญ
- [ููู ุชุนุฑู ุฅูู ูุฌุญุช ูู ูู ุฎุทูุฉ]

ุงููุต: ${transcript}`
};

export async function processWithGroq(transcript, type = 'all', apiKeyOverride = '') {
  try {
    const apiKey = apiKeyOverride || process.env.GROQ_API_KEY;
    if (!apiKey) {
      throw new Error('GROQ API key is missing');
    }

    const groq = new Groq({ apiKey });
    const prompt = prompts[type] ? prompts[type](transcript) : prompts.all(transcript);
    
    const completion = await groq.chat.completions.create({
      messages: [
        {
          role: 'system',
          content: 'ุฃูุช ุฎุจูุฑ ูู ุชุญููู ุงููุญุชูู ุงูุชุนูููู ูุงุณุชุฎุฑุงุฌ ุงูุชูุงุตูู ุงูุฏูููุฉ. ูููุชู ุชุญููู ุงูููุฏูููุงุช ุฅูู ุฃุฏูุฉ ุนูู ูุงุจูุฉ ููุชูููุฐ ุจุฏูุฉ ุดุฏูุฏุฉุ ุจุฏูู ุชูุฎูุต ุฃู ุญุฐู ุชูุงุตูู.'
        },
        {
          role: 'user',
          content: prompt
        }
      ],
      model: 'llama-3.3-70b-versatile',
      temperature: 0.3,
      max_tokens: 32000
    });

    return completion.choices[0]?.message?.content || '';
  } catch (error) {
    console.error('Groq API Error:', error);
    throw new Error('ูุดู ูู ูุนุงูุฌุฉ ุงููุต ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู: ' + error.message);
  }
}
